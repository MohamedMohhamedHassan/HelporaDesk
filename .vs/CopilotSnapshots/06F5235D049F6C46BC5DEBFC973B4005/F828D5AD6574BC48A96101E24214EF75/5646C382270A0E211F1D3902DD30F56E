@model IEnumerable<ServiceCore.Models.Ticket>
@{
    ViewData["Title"] = "Tickets";
    var page = (int)(ViewData["Page"] ?? 1);
    var pageSize = (int)(ViewData["PageSize"] ?? 20);
    var total = (int)(ViewData["TotalCount"] ?? Model.Count());
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4">Tickets</h1>
    <a class="btn btn-primary" href="/TicketsManager/Create">Create Ticket</a>
</div>

<form method="get" class="row g-2 mb-3">
    <div class="col-auto">
        <input class="form-control" name="search" value="@(ViewData["Search"] ?? "")" placeholder="Search tickets..." />
    </div>
    <div class="col-auto">
        <select name="status" class="form-select">
            <option value="">All status</option>
            <option value="Open" @(ViewData["Status"]?.ToString() == "Open" ? "selected" : "")>Open</option>
            <option value="Resolved" @(ViewData["Status"]?.ToString() == "Resolved" ? "selected" : "")>Resolved</option>
        </select>
    </div>
    <div class="col-auto">
        <input class="btn btn-outline-secondary" type="submit" value="Filter" />
    </div>
</form>

<table class="table table-hover">
    <thead>
        <tr>
            <th>Id</th>
            <th>Subject</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Requester</th>
            <th>Assigned</th>
            <th>Updated</th>
            <th class="text-end">Actions</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var t in Model)
    {
        <tr>
            <td>@t.Id</td>
            <td>@t.Subject</td>
            <td>@t.Status</td>
            <td>@t.Priority</td>
            <td>@t.Requester</td>
            <td>@t.Assigned</td>
            <td>@t.Updated</td>
            <td class="text-end">
                <a class="btn btn-sm btn-outline-secondary" href="/TicketsManager/Edit/@t.Id">Edit</a>
                <form method="post" asp-action="Delete" asp-route-id="@t.Id" style="display:inline">
                    <button class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
    }
    </tbody>
</table>

<nav>
    <ul class="pagination">
        @for (var i = 1; i <= (int)Math.Ceiling(total / (double)pageSize); i++)
        {
            <li class="page-item @(i == page ? "active" : "")"><a class="page-link" href="?page=@i">@i</a></li>
        }
    </ul>
</nav>
